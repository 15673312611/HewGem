import{r as u,u as j,w as z,o as D,e as a,f as l,g as r,I as T,M as F,h as d,m as p,a as k,J as i,U as L,j as b,W as N,y as W,t as v,s as A,k as x,C as P,X as J,Y as R,Z as X,_ as Y,$ as Z,a0 as q}from"./vendor-84cddc83.js";import{_ as G,a as H}from"./index-75d2a32e.js";const K={class:"min-h-screen bg-[#F7F8FA] p-6"},O={class:"max-w-7xl mx-auto"},Q={key:0,class:"grid grid-cols-5 gap-4"},ee={class:"relative h-[240px] bg-gray-100 overflow-hidden"},te=["src"],oe=["src"],se={key:2,class:"w-full h-full flex items-center justify-center flex-col"},re={key:3,class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"},ae=["onClick"],ne={class:"p-4 flex-1 flex flex-col"},le={class:"text-lg font-medium text-gray-800 mb-2 line-clamp-1 group-hover:text-primary transition-colors"},ie={class:"flex items-center justify-between mb-2"},de={class:"text-sm text-gray-500"},ce={class:"flex items-center justify-between mt-auto space-x-2"},ue={key:1,class:"bg-white rounded-lg p-20"},pe={class:"video-container"},fe=["src"],ge={__name:"Works",setup(_e){const f=u([]);j();const{loginModalVisible:C,showLoginModal:y}=H(),g=u(!1),_=u(""),c=u(null);z(C,o=>{if(!o){const e=localStorage.getItem("token"),s=localStorage.getItem("userId");e&&s&&m()}});const m=async()=>{var o,e;try{const s=localStorage.getItem("token"),n=localStorage.getItem("userId"),h=await k.get("/api/task/list",{params:{userId:n,page:1,pageSize:20},headers:{Authorization:`Bearer ${s}`}});f.value=h.data.data||[]}catch(s){((o=s.response)==null?void 0:o.status)===401||((e=s.response)==null?void 0:e.status)===403?y():(i.error("获取任务列表失败"),console.error(s))}},I=o=>new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),V=o=>({1:"审核中",2:"处理中",3:"已完成",4:"合成失败",5:"合成失败"})[o]||"未知状态",B=o=>{_.value=o.resultUrl,g.value=!0},M=o=>{try{const e=i({message:"正在准备下载...",type:"info",duration:0,showClose:!0}),s=document.createElement("a");s.href=o.resultUrl,s.download=`作品_${o.name||o.id}.mp4`,s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s),e.close(),i.success("下载已开始")}catch(e){i.error("下载失败："+(e.message||"未知错误"))}},E=o=>o?`${o.split("?")[0]}?x-oss-process=video/snapshot,t_0`:"",S=async o=>{var e,s;try{await X.confirm("确定要删除这个作品吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const n=localStorage.getItem("token");await k.delete(`/api/task/${o.id}`,{headers:{Authorization:`Bearer ${n}`}}),i.success("删除成功"),m()}catch(n){if(n==="cancel")return;((e=n.response)==null?void 0:e.status)===401||((s=n.response)==null?void 0:s.status)===403?y():i.error("删除失败")}},U=()=>{c.value&&(c.value.pause(),c.value.currentTime=0)};return D(()=>{m()}),(o,e)=>{const s=Y,n=Z,h=q,$=L;return a(),l("div",K,[r("div",O,[e[5]||(e[5]=r("h1",{class:"text-2xl font-medium text-gray-800 mb-6"},"我的作品",-1)),f.value.length>0?(a(),l("div",Q,[(a(!0),l(T,null,F(f.value,t=>(a(),l("div",{key:t.id,class:"bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-300 group h-[420px] flex flex-col"},[r("div",ee,[t.status==="1"||t.status==="2"||t.status==="4"||t.status==="5"?(a(),l("img",{key:0,src:E(t.videoUrl),class:"w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"},null,8,te)):t.status==="3"?(a(),l("video",{key:1,src:t.resultUrl,class:"w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"},null,8,oe)):(a(),l("div",se,[d(s,{class:"text-gray-400",size:40},{default:p(()=>[d(b(N))]),_:1})])),r("div",{class:W(["absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-medium shadow-sm",{"bg-yellow-100 text-yellow-800":t.status==="1","bg-blue-100 text-blue-800":t.status==="2","bg-green-100 text-green-800":t.status==="3","bg-red-100 text-red-800":t.status==="4"||t.status==="5"}])},v(V(t.status)),3),e[2]||(e[2]=r("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300"},null,-1)),t.status==="3"?(a(),l("div",re,[r("button",{onClick:A(w=>B(t),["stop"]),class:"w-12 h-12 rounded-full bg-white/90 hover:bg-white flex items-center justify-center transition-all duration-300 hover:scale-110"},e[1]||(e[1]=[r("div",{class:"w-0 h-0 border-t-[8px] border-t-transparent border-l-[12px] border-l-primary border-b-[8px] border-b-transparent ml-1"},null,-1)]),8,ae)])):x("",!0)]),r("div",ne,[r("h3",le,v(t.name),1),r("div",ie,[r("span",de,v(I(t.createTime)),1)]),r("div",ce,[t.status==="3"?(a(),P(n,{key:0,onClick:w=>M(t),class:"flex-1 h-11 px-0 bg-gradient-to-r from-blue-500 to-indigo-500 text-white border-0 shadow-[0_2px_8px_0_rgba(59,130,246,0.10)] hover:brightness-110 hover:shadow-[0_4px_16px_0_rgba(59,130,246,0.15)] transition-all duration-300 rounded-xl font-semibold tracking-wide relative overflow-hidden before:absolute before:inset-0 before:bg-white before:opacity-0 hover:before:opacity-5 before:transition-opacity before:duration-300",icon:b(J),size:"default"},{default:p(()=>e[3]||(e[3]=[r("span",{class:"text-white"},"下载视频",-1)])),_:2},1032,["onClick","icon"])):x("",!0),d(n,{onClick:w=>S(t),class:"flex-1 h-11 px-0 bg-gradient-to-r from-red-400 to-red-500 text-white border-0 shadow-[0_2px_8px_0_rgba(244,63,94,0.10)] hover:brightness-110 hover:shadow-[0_4px_16px_0_rgba(244,63,94,0.15)] transition-all duration-300 rounded-xl font-semibold tracking-wide relative overflow-hidden before:absolute before:inset-0 before:bg-white before:opacity-0 hover:before:opacity-5 before:transition-opacity before:duration-300",icon:b(R),size:"default"},{default:p(()=>e[4]||(e[4]=[r("span",{class:"text-white"},"删除",-1)])),_:2},1032,["onClick","icon"])])])]))),128))])):(a(),l("div",ue,[d(h,{description:"暂无作品"})]))]),d($,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),title:"视频播放",width:"800px","close-on-click-modal":!1,"close-on-press-escape":!0,class:"video-dialog",onClosed:U},{default:p(()=>[r("div",pe,[_.value?(a(),l("video",{key:0,ref_key:"videoPlayer",ref:c,src:_.value,controls:"",class:"video-player",autoplay:""},null,8,fe)):x("",!0)])]),_:1},8,["modelValue"])])}}},be=G(ge,[["__scopeId","data-v-cd838fba"]]);export{be as default};
