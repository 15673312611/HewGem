<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯• window.name + iframe è·¨åŸŸ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 4px;
      min-height: 50px;
    }
    .error {
      color: red;
      background: #ffebee;
    }
    .success {
      color: green;
      background: #e8f5e9;
    }
    button {
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }
    input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª window.name + iframe è·¨åŸŸæ–¹æ¡ˆæµ‹è¯•</h1>
  
  <div class="test-section">
    <h2>æµ‹è¯• 1ï¸âƒ£ï¼šå°è¯•åŠ è½½æŠ–éŸ³é¡µé¢åˆ° iframe</h2>
    <input type="text" id="douyinUrl" placeholder="è¾“å…¥æŠ–éŸ³è§†é¢‘é“¾æ¥ï¼Œä¾‹å¦‚ï¼šhttps://www.douyin.com/video/xxxxx" 
           value="https://www.douyin.com/">
    <button onclick="testDouyinIframe()">æµ‹è¯•åŠ è½½æŠ–éŸ³ iframe</button>
    <div id="result1" class="result"></div>
    <div id="iframeContainer" style="margin-top: 10px;"></div>
  </div>

  <div class="test-section">
    <h2>æµ‹è¯• 2ï¸âƒ£ï¼šwindow.name è·¨åŸŸåŸç†æ¼”ç¤ºï¼ˆä½¿ç”¨å¯åµŒå…¥çš„é¡µé¢ï¼‰</h2>
    <p style="color: #666; font-size: 14px;">
      æ¼”ç¤º window.name è·¨åŸŸçš„æ­£ç¡®ç”¨æ³•ï¼ˆä½¿ç”¨å…è®¸åµŒå…¥çš„æµ‹è¯•é¡µé¢ï¼‰
    </p>
    <button onclick="testWindowNameCrossOrigin()">æµ‹è¯• window.name è·¨åŸŸ</button>
    <div id="result2" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æµ‹è¯• 3ï¸âƒ£ï¼šæ£€æŸ¥æŠ–éŸ³çš„å®‰å…¨ç­–ç•¥</h2>
    <button onclick="checkDouyinHeaders()">æ£€æŸ¥æŠ–éŸ³å“åº”å¤´</button>
    <div id="result3" class="result"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ“Š æµ‹è¯•ç»“è®º</h2>
    <div id="conclusion" class="result" style="background: #fff3cd; color: #856404;">
      ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæµ‹è¯•...
    </div>
  </div>

  <script>
    // æµ‹è¯• 1ï¼šå°è¯•åŠ è½½æŠ–éŸ³é¡µé¢åˆ° iframe
    function testDouyinIframe() {
      const url = document.getElementById('douyinUrl').value;
      const result1 = document.getElementById('result1');
      const container = document.getElementById('iframeContainer');
      
      result1.innerHTML = 'â³ æ­£åœ¨å°è¯•åŠ è½½æŠ–éŸ³é¡µé¢åˆ° iframe...';
      result1.className = 'result';
      
      // æ¸…ç©ºä¹‹å‰çš„ iframe
      container.innerHTML = '';
      
      // åˆ›å»º iframe
      const iframe = document.createElement('iframe');
      iframe.style.width = '100%';
      iframe.style.height = '300px';
      iframe.style.border = '1px solid #ddd';
      iframe.src = url;
      
      // ç›‘å¬åŠ è½½é”™è¯¯
      let errorOccurred = false;
      
      iframe.onerror = function() {
        errorOccurred = true;
        result1.innerHTML = 'âŒ <strong>åŠ è½½å¤±è´¥</strong><br>' +
          'åŸå› ï¼šæŠ–éŸ³è®¾ç½®äº† X-Frame-Options å®‰å…¨ç­–ç•¥ï¼Œç¦æ­¢è¢«åµŒå…¥åˆ° iframe ä¸­ã€‚<br>' +
          'è¿™æ˜¯æŠ–éŸ³çš„å®‰å…¨é˜²æŠ¤æœºåˆ¶ï¼Œæ— æ³•ç»•è¿‡ã€‚';
        result1.className = 'result error';
        updateConclusion('fail');
      };
      
      // ç›‘å¬åŠ è½½æˆåŠŸï¼ˆå®é™…ä¸Šä¸ä¼šæˆåŠŸï¼‰
      iframe.onload = function() {
        if (errorOccurred) return;
        
        try {
          // å°è¯•è®¿é—® iframe å†…å®¹
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          result1.innerHTML = 'âœ… iframe åŠ è½½æˆåŠŸï¼ˆä½†è¿™ä¸æ˜¯æŠ–éŸ³é¡µé¢ï¼‰';
          result1.className = 'result success';
        } catch (e) {
          result1.innerHTML = 'âŒ <strong>è·¨åŸŸé”™è¯¯</strong><br>' +
            'å³ä½¿ iframe åŠ è½½äº†ï¼Œä¹Ÿæ— æ³•è®¿é—®å…¶å†…å®¹ã€‚<br>' +
            'é”™è¯¯ä¿¡æ¯ï¼š' + e.message;
          result1.className = 'result error';
          updateConclusion('fail');
        }
      };
      
      container.appendChild(iframe);
      
      // æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
      setTimeout(() => {
        if (!errorOccurred) {
          result1.innerHTML += '<br><br>ğŸ’¡ <strong>æç¤º</strong>ï¼šè¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ˜¯å¦æœ‰ X-Frame-Options é”™è¯¯ä¿¡æ¯ã€‚';
        }
      }, 2000);
    }

    // æµ‹è¯• 2ï¼šwindow.name è·¨åŸŸåŸç†æ¼”ç¤º
    function testWindowNameCrossOrigin() {
      const result2 = document.getElementById('result2');
      result2.innerHTML = 'â³ æ­£åœ¨æ¼”ç¤º window.name è·¨åŸŸåŸç†...';
      result2.className = 'result';
      
      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ•°æ®é¡µé¢ï¼ˆæ¨¡æ‹Ÿè·¨åŸŸé¡µé¢ï¼‰
      const dataPage = `
        <!DOCTYPE html>
        <html>
        <head><title>Data Page</title></head>
        <body>
          <script>
            // è®¾ç½® window.name ä¸ºæ•°æ®
            window.name = JSON.stringify({
              message: "è¿™æ˜¯æ¥è‡ªæ¨¡æ‹Ÿè·¨åŸŸé¡µé¢çš„æ•°æ®",
              timestamp: new Date().toISOString(),
              video: "æ¨¡æ‹Ÿè§†é¢‘ä¿¡æ¯"
            });
            
            // è·³è½¬å›ä»£ç†é¡µé¢ï¼ˆåŒæºï¼‰
            window.location.href = 'about:blank';
          </script>
        </body>
        </html>
      `;
      
      const blob = new Blob([dataPage], { type: 'text/html' });
      const blobUrl = URL.createObjectURL(blob);
      
      // åˆ›å»º iframe
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      document.body.appendChild(iframe);
      
      let step = 0;
      iframe.onload = function() {
        step++;
        
        if (step === 1) {
          // ç¬¬ä¸€æ¬¡åŠ è½½å®Œæˆï¼Œwindow.name å·²è®¾ç½®
          result2.innerHTML = 'âœ… æ­¥éª¤ 1ï¼šæ•°æ®é¡µé¢å·²åŠ è½½ï¼Œwindow.name å·²è®¾ç½®<br>' +
            'â³ æ­¥éª¤ 2ï¼šæ­£åœ¨è·³è½¬åˆ°åŒæºé¡µé¢...';
        } else if (step === 2) {
          // è·³è½¬åˆ°åŒæºé¡µé¢åï¼Œå¯ä»¥è¯»å– window.name
          try {
            const data = JSON.parse(iframe.contentWindow.name);
            result2.innerHTML = 'âœ… <strong>window.name è·¨åŸŸåŸç†éªŒè¯æˆåŠŸï¼</strong><br><br>' +
              '<strong>è·å–çš„æ•°æ®ï¼š</strong><br>' +
              '<pre>' + JSON.stringify(data, null, 2) + '</pre><br>' +
              '<strong>è¯´æ˜ï¼š</strong><br>' +
              '1. ç¬¬ä¸€æ­¥ï¼šiframe åŠ è½½è·¨åŸŸé¡µé¢ï¼Œé¡µé¢è®¾ç½® window.name<br>' +
              '2. ç¬¬äºŒæ­¥ï¼šiframe è·³è½¬åˆ°åŒæºé¡µé¢ï¼Œwindow.name ä¿ç•™<br>' +
              '3. ç¬¬ä¸‰æ­¥ï¼šçˆ¶é¡µé¢è¯»å– iframe.contentWindow.name<br><br>' +
              '<strong style="color: red;">ä½†æ˜¯ï¼æŠ–éŸ³ä¸å…è®¸è¢«åµŒå…¥ iframeï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•å¯¹æŠ–éŸ³æ— æ•ˆã€‚</strong>';
            result2.className = 'result success';
            
            // æ¸…ç†
            document.body.removeChild(iframe);
            URL.revokeObjectURL(blobUrl);
          } catch (e) {
            result2.innerHTML = 'âŒ è¯»å– window.name å¤±è´¥ï¼š' + e.message;
            result2.className = 'result error';
          }
        }
      };
      
      iframe.src = blobUrl;
    }

    // æµ‹è¯• 3ï¼šæ£€æŸ¥æŠ–éŸ³çš„å®‰å…¨ç­–ç•¥
    async function checkDouyinHeaders() {
      const result3 = document.getElementById('result3');
      result3.innerHTML = 'â³ æ­£åœ¨æ£€æŸ¥æŠ–éŸ³çš„å®‰å…¨ç­–ç•¥...';
      result3.className = 'result';
      
      try {
        // å°è¯• fetch è¯·æ±‚æŠ–éŸ³
        const response = await fetch('https://www.douyin.com/', {
          mode: 'no-cors' // ä½¿ç”¨ no-cors æ¨¡å¼é¿å… CORS é”™è¯¯
        });
        
        result3.innerHTML = 'âš ï¸ <strong>æ— æ³•ç›´æ¥è¯»å–æŠ–éŸ³çš„å“åº”å¤´</strong><br><br>' +
          '<strong>åŸå› ï¼š</strong><br>' +
          '1. CORS é™åˆ¶ï¼šæŠ–éŸ³ä¸å…è®¸è·¨åŸŸè®¿é—®<br>' +
          '2. no-cors æ¨¡å¼æ— æ³•è¯»å–å“åº”å¤´<br><br>' +
          '<strong>æŠ–éŸ³çš„å®‰å…¨ç­–ç•¥ï¼ˆå·²çŸ¥ï¼‰ï¼š</strong><br>' +
          'â€¢ X-Frame-Options: SAMEORIGINï¼ˆç¦æ­¢ iframe åµŒå…¥ï¼‰<br>' +
          'â€¢ Content-Security-Policy: frame-ancestors \'self\'<br>' +
          'â€¢ ä¸¥æ ¼çš„ CORS ç­–ç•¥<br>' +
          'â€¢ è¯·æ±‚ç­¾åéªŒè¯ï¼ˆX-Bogusï¼‰<br>' +
          'â€¢ User-Agent æ£€æµ‹<br>' +
          'â€¢ IP é™æµå’Œé»‘åå•<br><br>' +
          '<strong style="color: red;">è¿™äº›å®‰å…¨æªæ–½ä½¿å¾—çº¯å‰ç«¯æ–¹æ¡ˆæ— æ³•å®ç°ã€‚</strong>';
        result3.className = 'result';
        
        updateConclusion('fail');
      } catch (error) {
        result3.innerHTML = 'âŒ <strong>è¯·æ±‚å¤±è´¥</strong><br>' +
          'é”™è¯¯ä¿¡æ¯ï¼š' + error.message + '<br><br>' +
          'è¿™è¯æ˜äº†æŠ–éŸ³æœ‰ä¸¥æ ¼çš„è·¨åŸŸé™åˆ¶ã€‚';
        result3.className = 'result error';
        updateConclusion('fail');
      }
    }

    // æ›´æ–°ç»“è®º
    function updateConclusion(status) {
      const conclusion = document.getElementById('conclusion');
      
      if (status === 'fail') {
        conclusion.innerHTML = '<strong>ğŸš« æµ‹è¯•ç»“è®ºï¼šwindow.name + iframe æ–¹æ¡ˆä¸å¯è¡Œ</strong><br><br>' +
          '<strong>åŸå› æ€»ç»“ï¼š</strong><br>' +
          '1. âŒ æŠ–éŸ³è®¾ç½®äº† X-Frame-Optionsï¼Œæ— æ³•åµŒå…¥ iframe<br>' +
          '2. âŒ å³ä½¿èƒ½åµŒå…¥ï¼ŒæŠ–éŸ³ä¹Ÿä¸ä¼šä¸»åŠ¨è®¾ç½® window.name<br>' +
          '3. âŒ æ— æ³•ç»•è¿‡ CORS é™åˆ¶ä¸‹è½½è§†é¢‘<br>' +
          '4. âŒ æµè§ˆå™¨æ— æ³•å¤„ç†è§†é¢‘å’ŒéŸ³é¢‘æå–<br>' +
          '5. âŒ è¯­éŸ³è½¬æ–‡å­—éœ€è¦ AI æœåŠ¡ï¼Œå¿…é¡»é€šè¿‡åç«¯<br><br>' +
          '<strong>âœ… å¯è¡Œçš„æ–¹æ¡ˆï¼š</strong><br>' +
          'â€¢ ä½¿ç”¨åç«¯ä»£ç†æœåŠ¡ï¼ˆæ¨èï¼‰<br>' +
          'â€¢ ä½¿ç”¨ Serverless å‡½æ•°<br>' +
          'â€¢ ä½¿ç”¨ç¬¬ä¸‰æ–¹æŠ–éŸ³è§£æ API<br>' +
          'â€¢ å¼€å‘æµè§ˆå™¨æ‰©å±•ï¼ˆéƒ¨åˆ†åŠŸèƒ½ï¼‰';
        conclusion.className = 'result error';
      }
    }

    // é¡µé¢åŠ è½½æ—¶çš„æç¤º
    window.onload = function() {
      console.log('%cğŸ§ª æŠ–éŸ³è·¨åŸŸæ–¹æ¡ˆæµ‹è¯•', 'font-size: 20px; color: #4CAF50; font-weight: bold;');
      console.log('%cè¯·ä¾æ¬¡ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæµ‹è¯•', 'font-size: 14px; color: #666;');
      console.log('%cæ³¨æ„è§‚å¯Ÿæµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯', 'font-size: 14px; color: #ff9800;');
    };
  </script>
</body>
</html>

